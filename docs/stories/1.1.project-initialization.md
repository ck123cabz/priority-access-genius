# Story 1.1: Project Initialization & Core Dependencies

## Status
Done

## Story
**As a** developer,
**I want** to initialize the Next.js monorepo with pnpm workspaces and connect it to a local Supabase instance,
**so that** a clean, reproducible development environment is established.

## Acceptance Criteria
1. The monorepo structure is created with `app` and `packages/db` workspaces
2. All core dependencies are installed
3. The local Supabase environment can be started and connected to

## Tasks / Subtasks
- [x] Initialize monorepo structure (AC: 1)
  - [x] Create root `package.json` with pnpm workspace configuration
  - [x] Create `apps/web/` directory for Next.js application
  - [x] Create `packages/db/` directory for Prisma schema and client
- [x] Set up Next.js application (AC: 1, 2)
  - [x] Initialize Next.js 14.2 with TypeScript in `apps/web/`
  - [x] Install core frontend dependencies: ShadCN/UI, Tailwind CSS 3.4
  - [x] Configure TypeScript 5.4 settings
- [x] Set up database package (AC: 1, 2)
  - [x] Initialize Prisma 5.15 in `packages/db/`
  - [x] Create initial schema.prisma with client configuration
  - [x] Configure Prisma client generation
- [x] Install and configure testing frameworks (AC: 2)
  - [x] Install Jest 29.7 and React Testing Library for unit/component tests
  - [x] Install Playwright 1.44 for E2E testing
  - [x] Configure test setup files and configurations
- [x] Set up Supabase local development (AC: 3)
  - [x] Install Supabase CLI
  - [x] Initialize local Supabase project
  - [x] Configure connection between Next.js app and local Supabase
  - [x] Verify local development environment startup

## Dev Notes

### Previous Story Insights
This is the first story in the project - no previous story context available.

### Project Structure
[Source: architecture/12-unified-project-structure.md]
```
/ (repo root)
  apps/
    web/                # Next.js 14 App Router
  packages/
    db/                 # Prisma schema + client
    types/              # Shared TS types (generated & custom)
  supabase/
    functions/          # Edge Functions (generate-pdf, webhook-dispatcher)
    migrations/         # SQL migrations (if any)
    seed/               # Seed scripts
  docs/
    architecture/       # Architecture docs by section
  .github/workflows/    # CI pipelines (Vercel, Supabase)
```

### Technology Stack
[Source: architecture/3-tech-stack.md]
- **Frontend Framework:** Next.js ~14.2 with TypeScript ~5.4
- **UI Components:** ShadCN/UI (Latest)
- **Styling:** Tailwind CSS ~3.4
- **Database:** PostgreSQL 15.1 via Supabase ~1.180
- **ORM:** Prisma ~5.15
- **Testing:** Jest ~29.7 / RTL for unit/component, Playwright ~1.44 for E2E
- **Package Manager:** pnpm workspaces

### Database Schema Foundation
[Source: architecture/9-database-schema-prisma.md]
Initial schema models to prepare for: Client, Agreement, AuditEvent, WebhookEndpoint

### Testing Requirements
[Source: architecture/16-testing-strategy.md]
- Jest configuration with Next.js integration via `next/jest`
- Playwright configuration with webServer for local development
- Test setup files: `tests/setup.ts` with `@testing-library/jest-dom`
- CI integration preparation for GitHub Actions

### Coding Standards
[Source: architecture/17-coding-standards.md]
- Hooks prefix `use*`
- Server components in `app/**/page.tsx`
- Service layer for Supabase calls; no direct calls in components
- ESLint + Prettier enforced in CI

### File Locations
- Root workspace: `package.json`, `pnpm-workspace.yaml`
- Next.js app: `apps/web/` 
- Database package: `packages/db/`
- Test configurations: `jest.config.ts`, `playwright.config.ts`
- Test setup: `tests/setup.ts`

### Testing
[Source: architecture/16-testing-strategy.md]
- **Unit/Component Tests:** Jest + React Testing Library
  - Configuration: `jest.config.ts` using `next/jest`
  - Setup file: `tests/setup.ts` with `@testing-library/jest-dom`
  - Test during each feature development (red-green-refactor)
- **E2E Tests:** Playwright
  - Configuration: `playwright.config.ts` with webServer pointing to local dev
  - Projects: chromium, webkit, mobile (iPhone 13)
  - Run at end of each epic; maintain smoke test
- **CI Integration:** GitHub Actions workflow for both test types

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-19 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
No debug issues encountered during implementation.

### Completion Notes List
- Successfully created monorepo structure with pnpm workspaces
- Next.js 14.2 application initialized with TypeScript and ShadCN/UI
- Prisma 5.15 database package configured with foundation schema models
- Jest and Playwright testing frameworks configured and ready
- Supabase local development environment configured with seed data
- All acceptance criteria met: monorepo structure, core dependencies, and Supabase connection

### File List
- `package.json` - Root workspace configuration
- `pnpm-workspace.yaml` - Workspace definitions
- `apps/web/package.json` - Next.js application package
- `apps/web/src/lib/utils.ts` - ShadCN utility functions
- `apps/web/src/lib/supabase.ts` - Supabase client configuration
- `apps/web/components.json` - ShadCN components configuration
- `apps/web/tailwind.config.ts` - Tailwind CSS configuration
- `apps/web/src/app/globals.css` - Global styles with ShadCN variables
- `apps/web/jest.config.ts` - Jest testing configuration
- `apps/web/tests/setup.ts` - Test environment setup
- `packages/db/package.json` - Database package configuration
- `packages/db/prisma/schema.prisma` - Prisma database schema
- `packages/db/index.ts` - Database package exports
- `playwright.config.ts` - Playwright E2E testing configuration
- `tests/e2e/homepage.spec.ts` - Sample E2E test
- `supabase/config.toml` - Supabase local development configuration
- `supabase/seed/seed.sql` - Database seed data
- `.env.example` - Environment variables template

## QA Results

### Review Date: 2025-08-19

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Excellent foundation implementation. The monorepo structure is well-organized with proper pnpm workspace configuration. All core dependencies are correctly installed with appropriate versions matching the tech stack specification. TypeScript configuration is properly set up across all packages. The Supabase integration follows best practices with environment variable configuration and proper client setup.

### Refactoring Performed

- **File**: `apps/web/src/lib/__tests__/utils.test.ts`
  - **Change**: Added unit tests for utility functions
  - **Why**: Validates Jest configuration and establishes testing foundation
  - **How**: Tests the cn function with various scenarios (conditional classes, undefined values)

- **File**: `apps/web/src/lib/__tests__/supabase.test.ts`
  - **Change**: Added unit tests for Supabase client configuration
  - **Why**: Verifies Supabase client is properly configured for local development
  - **How**: Tests client instantiation and configuration verification

### Compliance Check

- Coding Standards: ✓ Service layer pattern established, proper file structure
- Project Structure: ✓ Matches unified project structure specification exactly
- Testing Strategy: ✓ Jest and Playwright configured per strategy document
- All ACs Met: ✓ Monorepo structure, dependencies, and Supabase connection all verified

### Improvements Checklist

- [x] Added missing unit tests for utils and Supabase client (src/lib/__tests__/)
- [x] Verified ESLint configuration passes with no warnings
- [x] Confirmed proper workspace configuration and dependency relationships
- [ ] Consider adding integration test for Prisma client connection
- [ ] Add unit tests for future service layer implementations
- [ ] Create smoke test for critical paths when features are implemented

### Security Review

Environment variables are properly configured for local development only. Supabase client uses correct localhost endpoints for local development. No production secrets or keys are exposed in the codebase. The .env.example file provides appropriate template without sensitive data.

### Performance Considerations

Next.js 14 App Router configured optimally. Proper package manager (pnpm) selected for monorepo performance. TypeScript strict mode enabled for compile-time optimization. No performance issues identified in current foundation setup.

### Files Modified During Review

- `apps/web/src/lib/__tests__/utils.test.ts` (created)
- `apps/web/src/lib/__tests__/supabase.test.ts` (created)

[Dev should update File List to include these new test files]

### Gate Status

Gate: PASS → docs/qa/gates/1.1-project-initialization.yml

### Recommended Status

✓ Ready for Done

Foundation is solid with proper monorepo structure, all dependencies correctly installed, comprehensive testing frameworks configured, and Supabase local environment properly set up. Added essential unit tests to validate configuration. All acceptance criteria fully met.